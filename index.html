<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì–¸íŒ¨í„´ Inc. â€” ë…¸ì…˜ ê°€ì´ë“œ ì±—ë´‡</title>
    <meta name="description" content="ì–¸íŒ¨í„´ Inc. ë…¸ì…˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ëŒ€í•œ ëª¨ë“  ì§ˆë¬¸ì— ë‹µí•©ë‹ˆë‹¤.">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>

    <!-- Background Effects -->
    <div class="bg-effects">
        <div class="bg-orb bg-orb-1"></div>
        <div class="bg-orb bg-orb-2"></div>
        <div class="bg-orb bg-orb-3"></div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-badge">
                <span class="logo-dot"></span>
                NOTION GUIDE BOT
            </div>
            <h1 class="app-title">ì–¸íŒ¨í„´ Inc. ê°€ì´ë“œ</h1>
            <p class="app-subtitle">ë…¸ì…˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ëŒ€í•œ ëª¨ë“  ê²ƒì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤</p>
        </header>

        <!-- Quick Actions -->
        <div class="quick-actions" id="quickActions">
            <button class="quick-btn" onclick="askQuestion('íšŒì‚¬ ê°œìš” ì•Œë ¤ì¤˜')">ğŸ¢ íšŒì‚¬ ì†Œê°œ</button>
            <button class="quick-btn" onclick="askQuestion('ì „ì²´ DB ëª©ë¡ ë³´ì—¬ì¤˜')">ğŸ—ƒï¸ DB ëª©ë¡</button>
            <button class="quick-btn" onclick="askQuestion('ì„¤ê³„ ì•„í‚¤í…ì²˜ ì„¤ëª…í•´ì¤˜')">ğŸ—ï¸ ì•„í‚¤í…ì²˜</button>
            <button class="quick-btn" onclick="askQuestion('WBS ì‹œìŠ¤í…œì´ ë­ì•¼?')">ğŸ“‹ WBS</button>
            <button class="quick-btn" onclick="askQuestion('ì±„ìš© ì‹œìŠ¤í…œ ì–´ë–»ê²Œ êµ¬ì„±ë˜ì–´ ìˆì–´?')">ğŸ‘¥ ì±„ìš©</button>
            <button class="quick-btn" onclick="askQuestion('ì±„ë„ ì„±ê³¼ DB ì•Œë ¤ì¤˜')">ğŸ“¡ ì±„ë„ ì„±ê³¼</button>
            <button class="quick-btn" onclick="askQuestion('Notion API ì„¤ì • ì•Œë ¤ì¤˜')">âš™ï¸ API ì—°ë™</button>
            <button class="quick-btn" onclick="askQuestion('ì‹œìŠ¤í…œ ì™„ì„±ë„ ì•Œë ¤ì¤˜')">ğŸ“Š í˜„í™©</button>
        </div>

        <!-- Category Tabs -->
        <div class="category-tabs" id="categoryTabs"></div>

        <!-- Chat Area -->
        <div class="chat-container" id="chatContainer"></div>

        <!-- Input Area -->
        <div class="input-area">
            <div class="input-wrapper">
                <input type="text" class="input-field" id="chatInput" placeholder="ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”... (ì˜ˆ: í”„ë¡œì íŠ¸ DB êµ¬ì¡°)"
                    autocomplete="off">
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                    â†‘
                </button>
            </div>
        </div>
    </div>

    <script src="knowledge.js"></script>
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // App State
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const engine = new SearchEngine(KNOWLEDGE_BASE);
        const chatContainer = document.getElementById('chatContainer');
        const chatInput = document.getElementById('chatInput');
        let activeCategory = null;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Init
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function init() {
            buildCategoryTabs();
            showWelcome();
            chatInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Category Tabs
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function buildCategoryTabs() {
            const tabs = document.getElementById('categoryTabs');
            const categories = engine.getCategories();

            const allTab = document.createElement('button');
            allTab.className = 'cat-tab active';
            allTab.textContent = 'ì „ì²´';
            allTab.onclick = () => selectCategory(null, allTab);
            tabs.appendChild(allTab);

            categories.forEach(cat => {
                const tab = document.createElement('button');
                tab.className = 'cat-tab';
                tab.textContent = cat;
                tab.onclick = () => selectCategory(cat, tab);
                tabs.appendChild(tab);
            });
        }

        function selectCategory(category, tabEl) {
            document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
            tabEl.classList.add('active');
            activeCategory = category;

            if (category) {
                showCategoryResults(category);
            }
        }

        function showCategoryResults(category) {
            const items = engine.getByCategory(category);
            chatContainer.innerHTML = '';

            const div = document.createElement('div');
            div.className = 'category-results';

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'result-item';
                card.innerHTML = `
          <div class="result-item-q">${item.question}</div>
          <div class="result-item-cat">${item.category}</div>
        `;
                card.onclick = () => askQuestion(item.question);
                div.appendChild(card);
            });

            chatContainer.appendChild(div);
            scrollToBottom();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Welcome
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showWelcome() {
            const welcomeData = [
                { emoji: 'ğŸ¢', title: 'íšŒì‚¬ & ë¸Œëœë“œ', desc: 'ì–¸íŒ¨í„´ Inc. ì†Œê°œ, 12ê°œ ë¸Œëœë“œ, 10ê°œ ì œí’ˆ', q: 'ì–¸íŒ¨í„´ Inc.ëŠ” ì–´ë–¤ íšŒì‚¬ì¸ê°€ìš”?' },
                { emoji: 'ğŸ—ƒï¸', title: 'DB êµ¬ì¡°', desc: '52ê°œ+ ë°ì´í„°ë² ì´ìŠ¤ì˜ ìŠ¤í‚¤ë§ˆì™€ ì†ì„±', q: 'ì „ì²´ DB ëª©ë¡ ë³´ì—¬ì¤˜' },
                { emoji: 'ğŸ”—', title: 'Relation ì²´ì¸', desc: 'OKRâ†’KPIâ†’í”„ë¡œì íŠ¸â†’ì—…ë¬´ ë°ì´í„° íë¦„', q: 'DB ê°„ Relation ì²´ì¸ ì•Œë ¤ì¤˜' },
                { emoji: 'ğŸ“‹', title: 'WBS ì‹œìŠ¤í…œ', desc: 'ì œí’ˆ ëŸ°ì¹­ íƒœìŠ¤í¬ ìë™í™”', q: 'WBS ì‹œìŠ¤í…œì´ë€?' },
                { emoji: 'ğŸ‘¥', title: 'ì±„ìš© ì‹œìŠ¤í…œ', desc: 'ì±„ìš© ê³µê³ â†’ì§€ì›ìâ†’í‰ê°€ íŒŒì´í”„ë¼ì¸', q: 'ì±„ìš© ì‹œìŠ¤í…œ ì–´ë–»ê²Œ êµ¬ì„±ë˜ì–´ ìˆì–´?' },
                { emoji: 'ğŸ“¡', title: 'ì±„ë„ ì„±ê³¼', desc: 'ROAS/CPA ìë™ ê³„ì‚°ê³¼ ì‹ í˜¸ë“± ì‹œìŠ¤í…œ', q: 'ì±„ë„ ì„±ê³¼ DB ì•Œë ¤ì¤˜' },
                { emoji: 'âš™ï¸', title: 'ìë™í™” ë„êµ¬', desc: 'API, MCP Server, n8n ì›Œí¬í”Œë¡œìš°', q: 'n8n ìë™í™” ì›Œí¬í”Œë¡œìš° ì•Œë ¤ì¤˜' },
                { emoji: 'ğŸ“Š', title: 'ìš´ì˜ í˜„í™©', desc: 'ì‹œìŠ¤í…œ ì™„ì„±ë„ì™€ ë‚¨ì€ ì‘ì—…', q: 'ì‹œìŠ¤í…œ ì™„ì„±ë„ ì•Œë ¤ì¤˜' }
            ];

            addBotMessage(`ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹ **ì–¸íŒ¨í„´ Inc. ë…¸ì…˜ ê°€ì´ë“œë´‡**ì…ë‹ˆë‹¤.

ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì˜ êµ¬ì¡°, DB ìŠ¤í‚¤ë§ˆ, ìë™í™” ì‹œìŠ¤í…œ ë“± ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”.

ì•„ë˜ ì£¼ì œë¥¼ í´ë¦­í•˜ê±°ë‚˜ ì§ì ‘ ì§ˆë¬¸ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”:`, welcomeData);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Messages
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function addUserMessage(text) {
            const msg = document.createElement('div');
            msg.className = 'message user';
            msg.innerHTML = `
        <div class="message-avatar">ğŸ‘¤</div>
        <div class="message-bubble">${escapeHtml(text)}</div>
      `;
            chatContainer.appendChild(msg);
            scrollToBottom();
        }

        function addBotMessage(text, welcomeCards = null) {
            const msg = document.createElement('div');
            msg.className = 'message bot';

            let bubbleContent = renderMarkdown(text);

            if (welcomeCards) {
                bubbleContent += `<div class="welcome-grid">`;
                welcomeCards.forEach(card => {
                    bubbleContent += `
            <div class="welcome-card" onclick="askQuestion('${card.q}')">
              <div class="welcome-card-emoji">${card.emoji}</div>
              <div class="welcome-card-title">${card.title}</div>
              <div class="welcome-card-desc">${card.desc}</div>
            </div>
          `;
                });
                bubbleContent += `</div>`;
            }

            msg.innerHTML = `
        <div class="message-avatar">ğŸ¤–</div>
        <div class="message-bubble">${bubbleContent}</div>
      `;
            chatContainer.appendChild(msg);
            scrollToBottom();
        }

        function addBotMessageWithRelated(text, relatedItems, notionUrl = null) {
            const msg = document.createElement('div');
            msg.className = 'message bot';

            let bubbleContent = renderMarkdown(text);

            if (notionUrl) {
                bubbleContent += `<div class="notion-link-container">
                    <a href="${notionUrl}" target="_blank" rel="noopener noreferrer" class="notion-link-btn">
                        <svg width="16" height="16" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6.017 4.313l55.333-4.087c6.797-.583 8.543-.19 12.817 2.917l17.663 12.443c2.913 2.14 3.883 2.723 3.883 5.053v68.243c0 4.277-1.553 6.807-6.99 7.193L24.467 99.967c-4.08.193-6.023-.39-8.16-3.113L3.3 79.94c-2.333-3.113-3.3-5.443-3.3-8.167V11.113c0-3.497 1.553-6.413 6.017-6.8z" fill="#fff"/>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M61.35.227L6.017 4.313C1.553 4.7 0 7.617 0 11.113v60.66c0 2.723.967 5.053 3.3 8.167l12.81 16.913c2.137 2.723 4.08 3.307 8.16 3.113L88.723 96.08c5.437-.387 6.99-2.917 6.99-7.193V20.64c0-2.21-.865-2.864-3.45-4.733L74.167 3.14C69.893.137 68.147-.257 61.35.227zM25.723 19.773c-5.433.413-6.673.507-9.773-1.947L7.953 11.3c-.97-.78-1.553-1.753-1.553-2.917 0-1.363 1.17-2.527 3.11-2.723l52.503-3.887c4.47-.393 6.793.97 8.543 2.333l10.69 7.587c.39.193 1.36 1.363 1.36 2.53 0 1.36-1.167 2.527-2.53 2.72L25.723 19.773zm-4.47 71.6V29.12c0-2.527.78-3.697 3.11-3.893l58.3-3.5c2.14-.193 3.11 1.167 3.11 3.693v62.057c0 2.53-.387 4.667-3.887 4.867L31.45 95.467c-3.5.193-5.023-.97-5.023-4.093h-5.173zM78.42 32.43c.39 1.753 0 3.503-1.753 3.697l-2.917.583v46.047c-2.527 1.363-4.86 2.14-6.797 2.14-3.113 0-3.89-.973-6.21-3.887L42.127 53.78v25.87l6.017 1.36s0 3.5-4.867 3.5l-13.397.78c-.39-.78 0-2.723 1.36-3.11l3.5-.967V44.377L30.86 44c-.39-1.75.583-4.277 3.3-4.473l14.367-.967 19.243 29.4V45.357l-5.047-.583c-.39-2.143 1.163-3.7 3.103-3.89l13.597-.453z" fill="#000"/>
                        </svg>
                        ë…¸ì…˜ì—ì„œ ë³´ê¸°
                        <span class="notion-link-arrow">â†’</span>
                    </a>
                </div>`;
            }

            if (relatedItems && relatedItems.length > 0) {
                bubbleContent += `<div class="related-questions">`;
                relatedItems.forEach(item => {
                    bubbleContent += `<button class="related-q-btn" onclick="askQuestion('${item.question}')">${item.question}</button>`;
                });
                bubbleContent += `</div>`;
            }

            msg.innerHTML = `
        <div class="message-avatar">ğŸ¤–</div>
        <div class="message-bubble">${bubbleContent}</div>
      `;
            chatContainer.appendChild(msg);
            scrollToBottom();
        }

        function showTyping() {
            const msg = document.createElement('div');
            msg.className = 'message bot';
            msg.id = 'typing-msg';
            msg.innerHTML = `
        <div class="message-avatar">ğŸ¤–</div>
        <div class="message-bubble">
          <div class="typing-indicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
        </div>
      `;
            chatContainer.appendChild(msg);
            scrollToBottom();
        }

        function removeTyping() {
            const el = document.getElementById('typing-msg');
            if (el) el.remove();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Send & Process
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            chatInput.value = '';
            addUserMessage(text);
            processQuery(text);
        }

        function askQuestion(question) {
            addUserMessage(question);
            processQuery(question);
        }

        function processQuery(query) {
            showTyping();

            setTimeout(() => {
                removeTyping();

                const results = engine.search(query);

                if (results.length === 0) {
                    addBotMessage(`ì£„ì†¡í•©ë‹ˆë‹¤, **"${query}"**ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ğŸ˜…

ë‹¤ìŒê³¼ ê°™ì€ ì£¼ì œë¡œ ì§ˆë¬¸í•´ ë³´ì„¸ìš”:
- íšŒì‚¬ ê°œìš”, ë¸Œëœë“œ, ì œí’ˆ
- DB êµ¬ì¡°, ì†ì„±, Relation
- WBS, ì±„ìš©, ì±„ë„ ì„±ê³¼
- API, MCP, n8n ìë™í™”
- ì‹œìŠ¤í…œ ì™„ì„±ë„, ë‚¨ì€ ì‘ì—…`);
                    return;
                }

                const topResult = results[0];
                const relatedResults = results.slice(1, 4).filter(r => r.score > 3);

                addBotMessageWithRelated(topResult.answer, relatedResults, topResult.notionUrl || null);
            }, 400 + Math.random() * 300);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Helpers
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderMarkdown(text) {
            if (typeof marked !== 'undefined') {
                marked.setOptions({
                    breaks: true,
                    gfm: true
                });
                return marked.parse(text);
            }
            // Fallback if marked.js not loaded
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function scrollToBottom() {
            setTimeout(() => {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }, 50);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Start!
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        init();
    </script>
</body>

</html>